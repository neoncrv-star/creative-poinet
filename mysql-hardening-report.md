## ุชูุฑูุฑ ุชุดุฏูุฏ ุฅุนุฏุงุฏุงุช MySQL

### 1. ุงููููุงุช ุงููุนุฏูุฉ
- config/database.js
- app.js
- package.json

### 2. ููุฎุต ุงูุชุบููุฑุงุช ุงูุฑุฆูุณูุฉ

#### 2.1 ุงูุงุนุชูุงุฏ ุงููุงูู ุนูู MySQL ุจุฏูู ุฃู fallback
- ุฅุฒุงูุฉ ุฃู ููุทู ูุณูุญ ุจุงุณุชุฎุฏุงู SQLite ุฃู ุฃู dialect ุขุฎุฑ.
- ุถุจุท Sequelize ููุนูู ุฏุงุฆููุง ุจุงูุฎูุงุฑุงุช ุงูุชุงููุฉ:
  - dialect: mysql
  - host ูุฃุฎูุฐ ูู ุงููุชุบูุฑ DB_HOST ุจุฏูู ุฃู ูููุฉ ุงูุชุฑุงุถูุฉ.

#### 2.2 ุชุญููู ูุถุจุท ูููุงุช ุงูุจูุฆุฉ ENV
- ูู config/database.js:
  - ุชุญููู ููู .env ูู ูุถุน ุงูุชุทููุฑ (NODE_ENV != production).
  - ุชุญููู ููู .env.prod ูู ูุถุน ุงูุฅูุชุงุฌ (NODE_ENV === production).
  - ูู ุญุงู ุนุฏู ูุฌูุฏ ุงูููู ุงูููุงุณุจ ูุชู ุทุจุงุนุฉ:
    - โ ENV file missing.
    - ุซู ุฅููุงู ุงูุนูููุฉ process.exit(1).
- ุจุนุฏ ุชุญููู env ูุชู ุงูุชุญูู ุงูุตุงุฑู ูู ุงููุชุบูุฑุงุช:
  - DB_NAME
  - DB_HOST
  - DB_USER
  - ูู ุญุงู ููุต ุฃู ูููุง ูุชู ุทุจุงุนุฉ:
    - โ Missing MySQL environment variables. Server stopped.
    - ุซู process.exit(1).
- ุฅุฒุงูุฉ ููุทู ุงูุชุญููู ูู ุงููุณุงุฑุงุช ุงููุฏููุฉ (legacy paths) ูุถูุงู ุนุฏู ุงุฎุชูุงู ุงูุจูุฆุงุช.
- ุฅุฒุงูุฉ ุฏุงูุฉ loadEnv ูู app.js ูุงูุงุนุชูุงุฏ ุนูู ุงูุชุญููู ุงููุฑูุฒู ูู config/database.js.

#### 2.3 ุถุจุท Connection Pool
- ูู config/database.js ุชู ุถุจุท pool ูููู ุซุงุจุชุฉ ููุง ุทููุจ:
  - max: 10
  - min: 2
  - idle: 10000 ms
  - acquire: 30000 ms

#### 2.4 ูุฑุงูุจุฉ ูููุน ุชุบููุฑ dialect
- ุจุนุฏ ุชููุฆุฉ Sequelize ูู config/database.js:
  - ูุชู ูุฑุงุกุฉ dialect ุงููุนูู:
    - sequelize.getDialect()
  - ุฅุฐุง ูุงู ุฃู ุดูุก ุบูุฑ mysql:
    - ูุชู ุทุจุงุนุฉ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ูู console ู debug.log:
      - โ Invalid DB dialect detected: <dialect>. Only 'mysql' is allowed.
    - ุซู ูุชู ุฅููุงู ุงูุนูููุฉ process.exit(1).

#### 2.5 ensureMySQLConnection ูุจู ุฃู sync ุฃู ุชุดุบูู ููุณูุฑูุฑ
- ูู app.js ุชูุช ุฅุถุงูุฉ ุฏุงูุฉ:
  - async function ensureMySQLConnection(retries = 10)
  - ุชุญุงูู ุงูุงุชุตุงู ุจู MySQL ุนุจุฑ sequelize.authenticate() ุญุชู 10 ูุฑุงุชุ ูุน ุงูุชุธุงุฑ 3 ุซูุงูู ุจูู ูู ูุญุงููุฉ.
  - ุนูุฏ ูู ูุดู ุงุชุตุงู:
    - ูุชู ุชุณุฌูู:
      - โ๏ธ Waiting for MySQL... <error message>
    - ูู ูู ูู console ู debug.log.
  - ุนูุฏ ุงููุฌุงุญ:
    - ูุชู ููุงุณ ุฒูู ุงูุงุชุตุงู ุจุงููููู ุซุงููุฉ.
    - ูุชู ุชุณุฌูู ูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู console ู debug.log:
      - ๐ Database:
        - host: DB_HOST
        - name: DB_NAME
        - dialect: mysql
        - latency: "X ms"
  - ุฅุฐุง ูุดูุช ูู ุงููุญุงููุงุช:
    - ูุชู ุชุณุฌูู:
      - โ MySQL is not reachable. Server stopped.
    - ุซู process.exit(1).
- ูุจู ุฃู sequelize.sync ูุชู ุงุณุชุฏุนุงุก ensureMySQLConnection ูุถูุงู ุฌุงูุฒูุฉ MySQL.

#### 2.6 ููุน ูุถุน Degraded Mode ููุงุฆููุง
- ูู app.js:
  - ุชู ุงุณุชุจุฏุงู ููุทู catch ุงููุฏูู ุงูุฐู ูุงู ูุดุบู ุงูุณูุฑูุฑ ูู ูุถุน degraded ุนูุฏ ูุดู sync.
  - ุงูููุทู ุงูุฌุฏูุฏ:
    - ุฃู ุฎุทุฃ ูู startup (ุณูุงุก ุฃุซูุงุก ensureMySQLConnection ุฃู sync ุฃู startServer) ูุคุฏู ุฅูู:
      - ุชุณุฌูู ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ูู debug.log ู console.
      - ุซู ุฅููุงุก ุงูุนูููุฉ process.exit(1).

#### 2.7 ุชุณุฌููุงุช ุงูุจุฏุก ูู console ู debug.log
- ุนูุฏ ุจุฏุก ุงูุชุทุจูู ุจูุฌุงุญ:
  - ูุชู ุชุณุฌูู:
    - ูุฌุงุญ ูุฒุงููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database synced successfully (MySQL)).
    - ุชุดุบูู ุงูุณูุฑูุฑ (Server is running at http://localhost:<port>).
  - ุฑุณุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุชูุตูููุฉ ูู ensureMySQLConnection ููุง ูู ุงููุณู 2.5.
- ุชู ุงูุญูุงุธ ุนูู ุชุณุฌูู ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ ูู debug.log ูุน logger ูุฎุตุต ูู config/database.js.

#### 2.8 ููุทุฉ ูุญุต ุงูุตุญุฉ ุงูุฎุงุตุฉ ุจูุงุนุฏุฉ ุงูุจูุงูุงุช /health/db
- ุฅุถุงูุฉ endpoint ุฌุฏูุฏ ูู app.js:
  - GET /health/db
  - ุงูุณููู:
    - ูููู ุจุชูููุฐ sequelize.authenticate() ูููุงุณ ุฒูู ุงูุงุณุชุฌุงุจุฉ.
    - ูุญุงูู ูุฑุงุกุฉ ูุนูููุงุช ุงูู pool (active / idle) ูู connectionManager.pool (ุจุดูู best-effort).
  - ูู ุญุงูุฉ ุงููุฌุงุญ:
    - ููุฏ ุงูุงุณุชุฌุงุจุฉ: 200
    - ุฌุณู ุงูุงุณุชุฌุงุจุฉ:
      - {
          "status": "ok",
          "latency": "X ms",
          "pool": {
            "active": <number | null>,
            "idle": <number | null>
          }
        }
  - ูู ุญุงูุฉ ุงููุดู:
    - ููุฏ ุงูุงุณุชุฌุงุจุฉ: 500
    - ุฌุณู ุงูุงุณุชุฌุงุจุฉ:
      - {
          "status": "error",
          "latency": "X ms",
          "pool": {
            "active": null,
            "idle": null
          }
        }
    - ูุน ุชุณุฌูู ุฑุณุงูุฉ ุฎุทุฃ ูู debug.log ู console.

#### 2.9 ุชูุธูู ุงูุงุนุชูุงุฏ ุนูู SQLite
- ุฅุฒุงูุฉ fallback ุงููุงูู ุฅูู SQLite ูู config/database.js.
- ุฅุฒุงูุฉ ุญุฒูุฉ sqlite3 ูู package.json (optionalDependencies) ุจุญูุซ ูุง ูุชู ุชุซุจูุชูุง.
- ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃู ููุฏ ูุณุชุฎุฏู dialect: 'sqlite' ูู ุงููุดุฑูุน (ุจุงุณุชุซูุงุก ุขุซุงุฑ ูุฏููุฉ ูู debug.log ุฃู ูููุงุช lock).

### 3. ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช ุงูุนูููุฉ

> ููุงุญุธุฉ: ููุฑุณุฉ ุงูููุฏ ุงูุขููุฉ (indexing) ูู ุจูุฆุฉ ุงูุนูู ูู ุชูู ุฌุงูุฒุฉุ ูุฐูู ุชู ุงูุงุนุชูุงุฏ ุนูู ุงุณุชูุดุงู ุงููููุงุช ูุฏูููุง ูุฃุฏูุงุช ุงูุจุญุซ ุงููุญููุฉ ูุถูุงู ุชุบุทูุฉ ุฌููุน ูุณุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช.

#### 3.1 ุชุดุบูู ุงูุณูุฑูุฑ ุจุฏูู ูุชุบูุฑุงุช MySQL ูู .env (ุจูุฆุฉ ุชุทููุฑ)
- ุงูุฃูุฑ:
  - npm start
- ุงููุชูุฌุฉ:
  - ุชู ุชุญููู .env ูู ุฌุฐุฑ ุงููุดุฑูุน.
  - ูุนุฏู ูุฌูุฏ DB_NAME / DB_HOST / DB_USER ุชู ุฅุธูุงุฑ:
    - โ Missing MySQL environment variables. Server stopped.
  - ุงูุนูููุฉ ุงูุชูุช ุจููุฏ ุฎุฑูุฌ ุบูุฑ ุตูุฑู ููุง ูู ูุชููุน.

#### 3.2 ุชุดุบูู ุงูุณูุฑูุฑ ูู ูุถุน ุงูุฅูุชุงุฌ ุจุฏูู MySQL ูุนูู (ุจุงุณุชุฎุฏุงู .env.prod)
- ุงูุฃูุฑ:
  - $env:NODE_ENV='production'; npm start
- ุงููุชูุฌุฉ:
  - ุชู ุชุญููู .env.prod ุจูุฌุงุญ.
  - ุชูุช ูุญุงููุฉ ุงูุงุชุตุงู ุจู MySQL ุนูู 127.0.0.1:3306 ุนุดุฑ ูุฑุงุช.
  - ูู ูู ูุญุงููุฉ ูุธูุฑ:
    - โ๏ธ Waiting for MySQL... connect ECONNREFUSED 127.0.0.1:3306
  - ุจุนุฏ ุงูุชูุงุก ุงููุญุงููุงุช:
    - ุชู ุชุณุฌูู:
      - โ MySQL is not reachable. Server stopped.
    - ุซู ุฅููุงุก ุงูุนูููุฉ ุจููุฏ ุฎุฑูุฌ ุบูุฑ ุตูุฑู.
  - ูุฐุง ูุคูุฏ ุฃู ุงููุธุงู ูุง ูุนูู ุจุฏูู MySQL ููุง ูุฏุฎู ูู ูุถุน degraded.

#### 3.3 ุณููุงุฑูู "ุงูุณูุฑูุฑ ูุน MySQL โ ูุฌุจ ุฃู ูุนูู"
- ูู ูุฐู ุงูุจูุฆุฉ ุงูุชุฌุฑูุจูุฉ ูู ููู ููุงู ุฎุงุฏู MySQL ูุนูู ุนูู 127.0.0.1:3306ุ ูุฐูู ูู ูุชู ุงูุชุญูู ุนููููุง ูู ูุณุงุฑ ุงููุฌุงุญ.
- ูุน ุฐูู:
  - ููุณ ุงูููุฏ ุงูุฐู ูุญุตูุงู ูู 3.2 ุณูููู ุจุนุฏ ุฃูู ุงุชุตุงู ูุงุฌุญ ุจูุง ููู:
    - ุชุณุฌูู ูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (host, name, dialect, latency).
    - ุชูููุฐ sequelize.sync(syncOptions).
    - ุชุดุบูู ุงูุณูุฑูุฑ ุนูู ุงููููุฐ ุงููุญุฏุฏ.
  - ุฃู ูุดู ูุงุญู ูู sync ุฃู startup ุณูุคุฏู ุฅูู ุฅููุงู ุงูุนูููุฉ ููุฑูุง ุจุฏูู ุฃู fallback.

### 4. ุฎูุงุตุฉ
- ุฌููุน ูุณุงุฑุงุช ุชุดุบูู ุงูุชุทุจูู ุงูุขู ุชุนุชูุฏ ุจุดูู ุตุงุฑู ุนูู MySQL ููุท.
- ูุง ููุฌุฏ ุฃู fallback ุฅูู SQLite ุฃู ุฃู dialect ุขุฎุฑ.
- ุฃู ููุต ูู:
  - ูููุงุช env ุงูุฅูุฒุงููุฉ (.env ุฃู .env.prod)ุ ุฃู
  - ูุชุบูุฑุงุช MySQL ุงูุฃุณุงุณูุฉ (DB_NAME, DB_HOST, DB_USER)ุ ุฃู
  - ูุฏุฑุฉ MySQL ุนูู ูุจูู ุงูุงุชุตุงูุงุชุ
  ูุคุฏู ูุจุงุดุฑุฉ ุฅูู ุฅููุงู ุงูุนูููุฉ ูุน ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูู ูู ูู console ู debug.log.
- ุชูุช ุฅุถุงูุฉ health endpoint ูุชุฎุตุต ููุงุนุฏุฉ ุงูุจูุงูุงุช /health/db ูุชุชุจุน ุญุงูุฉ ุงูุงุชุตุงู ูุงูุฒูู ูุงูู pool.
- ุชู ุฅุฒุงูุฉ ุฃู ูุถุน Degraded Mode ุจุญูุซ ูุง ูุนูู ุงููุธุงู ุฅุทูุงููุง ุฅุฐุง ูู ุชูู MySQL ูู ุญุงูุฉ ุณูููุฉ.

